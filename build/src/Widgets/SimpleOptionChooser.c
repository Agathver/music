/* SimpleOptionChooser.c generated by valac 0.11.7, the Vala compiler
 * generated from SimpleOptionChooser.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <gdk/gdk.h>
#include <gee.h>
#include <gdk-pixbuf/gdk-pixdata.h>
#include <string.h>
#include <stdlib.h>


#define BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER (beat_box_simple_option_chooser_get_type ())
#define BEAT_BOX_SIMPLE_OPTION_CHOOSER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, BeatBoxSimpleOptionChooser))
#define BEAT_BOX_SIMPLE_OPTION_CHOOSER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, BeatBoxSimpleOptionChooserClass))
#define BEAT_BOX_IS_SIMPLE_OPTION_CHOOSER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER))
#define BEAT_BOX_IS_SIMPLE_OPTION_CHOOSER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER))
#define BEAT_BOX_SIMPLE_OPTION_CHOOSER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, BeatBoxSimpleOptionChooserClass))

typedef struct _BeatBoxSimpleOptionChooser BeatBoxSimpleOptionChooser;
typedef struct _BeatBoxSimpleOptionChooserClass BeatBoxSimpleOptionChooserClass;
typedef struct _BeatBoxSimpleOptionChooserPrivate BeatBoxSimpleOptionChooserPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
typedef struct _Block12Data Block12Data;

struct _BeatBoxSimpleOptionChooser {
	GtkEventBox parent_instance;
	BeatBoxSimpleOptionChooserPrivate * priv;
};

struct _BeatBoxSimpleOptionChooserClass {
	GtkEventBoxClass parent_class;
	gboolean (*buttonPress) (BeatBoxSimpleOptionChooser* self, GdkEventButton* event);
	gboolean (*exposeEvent) (BeatBoxSimpleOptionChooser* self, GdkEventExpose* event);
};

struct _BeatBoxSimpleOptionChooserPrivate {
	GtkMenu* menu;
	GeeLinkedList* items;
	GdkPixbuf* enabled;
	GdkPixbuf* disabled;
	gint clicked_index;
	gint previous_index;
	gboolean toggling;
};

struct _Block12Data {
	int _ref_count_;
	BeatBoxSimpleOptionChooser * self;
	GtkCheckMenuItem* item;
};


static gpointer beat_box_simple_option_chooser_parent_class = NULL;

GType beat_box_simple_option_chooser_get_type (void) G_GNUC_CONST;
#define BEAT_BOX_SIMPLE_OPTION_CHOOSER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, BeatBoxSimpleOptionChooserPrivate))
enum  {
	BEAT_BOX_SIMPLE_OPTION_CHOOSER_DUMMY_PROPERTY
};
BeatBoxSimpleOptionChooser* beat_box_simple_option_chooser_new (GdkPixbuf* enabled, GdkPixbuf* disabled);
BeatBoxSimpleOptionChooser* beat_box_simple_option_chooser_construct (GType object_type, GdkPixbuf* enabled, GdkPixbuf* disabled);
gboolean beat_box_simple_option_chooser_buttonPress (BeatBoxSimpleOptionChooser* self, GdkEventButton* event);
static gboolean _beat_box_simple_option_chooser_buttonPress_gtk_widget_button_press_event (GtkWidget* _sender, GdkEventButton* event, gpointer self);
gboolean beat_box_simple_option_chooser_exposeEvent (BeatBoxSimpleOptionChooser* self, GdkEventExpose* event);
static gboolean _beat_box_simple_option_chooser_exposeEvent_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self);
void beat_box_simple_option_chooser_setOption (BeatBoxSimpleOptionChooser* self, gint index);
gint beat_box_simple_option_chooser_appendItem (BeatBoxSimpleOptionChooser* self, const gchar* text);
static Block12Data* block12_data_ref (Block12Data* _data12_);
static void block12_data_unref (Block12Data* _data12_);
static void _lambda13_ (Block12Data* _data12_);
static void __lambda13__gtk_check_menu_item_toggled (GtkCheckMenuItem* _sender, gpointer self);
static gboolean beat_box_simple_option_chooser_real_buttonPress (BeatBoxSimpleOptionChooser* self, GdkEventButton* event);
static gboolean beat_box_simple_option_chooser_real_exposeEvent (BeatBoxSimpleOptionChooser* self, GdkEventExpose* event);
static void beat_box_simple_option_chooser_finalize (GObject* obj);


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static gboolean _beat_box_simple_option_chooser_buttonPress_gtk_widget_button_press_event (GtkWidget* _sender, GdkEventButton* event, gpointer self) {
	gboolean result;
	result = beat_box_simple_option_chooser_buttonPress (self, event);
	return result;
}


static gboolean _beat_box_simple_option_chooser_exposeEvent_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self) {
	gboolean result;
	result = beat_box_simple_option_chooser_exposeEvent (self, event);
	return result;
}


BeatBoxSimpleOptionChooser* beat_box_simple_option_chooser_construct (GType object_type, GdkPixbuf* enabled, GdkPixbuf* disabled) {
	BeatBoxSimpleOptionChooser * self = NULL;
	GdkPixbuf* _tmp0_;
	GdkPixbuf* _tmp1_;
	GtkMenu* _tmp2_ = NULL;
	GeeLinkedList* _tmp3_ = NULL;
	gint _tmp4_ = 0;
	gint _tmp5_;
	gint _tmp6_;
	gint _tmp9_ = 0;
	gint _tmp10_;
	gint _tmp11_;
	GdkColor c = {0};
	GdkColor _tmp14_ = {0};
	g_return_val_if_fail (enabled != NULL, NULL);
	g_return_val_if_fail (disabled != NULL, NULL);
	self = (BeatBoxSimpleOptionChooser*) g_object_new (object_type, NULL);
	_tmp0_ = _g_object_ref0 (enabled);
	_g_object_unref0 (self->priv->enabled);
	self->priv->enabled = _tmp0_;
	_tmp1_ = _g_object_ref0 (disabled);
	_g_object_unref0 (self->priv->disabled);
	self->priv->disabled = _tmp1_;
	_tmp2_ = (GtkMenu*) gtk_menu_new ();
	_g_object_unref0 (self->priv->menu);
	self->priv->menu = g_object_ref_sink (_tmp2_);
	_tmp3_ = gee_linked_list_new (GTK_TYPE_CHECK_MENU_ITEM, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL);
	_g_object_unref0 (self->priv->items);
	self->priv->items = _tmp3_;
	self->priv->toggling = FALSE;
	_tmp5_ = gdk_pixbuf_get_width (enabled);
	_tmp6_ = gdk_pixbuf_get_width (disabled);
	if (_tmp5_ > _tmp6_) {
		gint _tmp7_;
		_tmp7_ = gdk_pixbuf_get_width (enabled);
		_tmp4_ = _tmp7_;
	} else {
		gint _tmp8_;
		_tmp8_ = gdk_pixbuf_get_width (disabled);
		_tmp4_ = _tmp8_;
	}
	g_object_set ((GtkWidget*) self, "width-request", _tmp4_, NULL);
	_tmp10_ = gdk_pixbuf_get_height (enabled);
	_tmp11_ = gdk_pixbuf_get_height (disabled);
	if (_tmp10_ > _tmp11_) {
		gint _tmp12_;
		_tmp12_ = gdk_pixbuf_get_height (enabled);
		_tmp9_ = _tmp12_;
	} else {
		gint _tmp13_;
		_tmp13_ = gdk_pixbuf_get_height (disabled);
		_tmp9_ = _tmp13_;
	}
	g_object_set ((GtkWidget*) self, "height-request", _tmp9_, NULL);
	self->priv->clicked_index = 0;
	self->priv->previous_index = 1;
	memset (&c, 0, sizeof (GdkColor));
	gdk_color_parse ("#FFFFFF", &_tmp14_);
	c = _tmp14_;
	gtk_widget_modify_bg ((GtkWidget*) self, GTK_STATE_NORMAL, &c);
	g_signal_connect_object ((GtkWidget*) self, "button-press-event", (GCallback) _beat_box_simple_option_chooser_buttonPress_gtk_widget_button_press_event, self, 0);
	g_signal_connect_object ((GtkWidget*) self, "expose-event", (GCallback) _beat_box_simple_option_chooser_exposeEvent_gtk_widget_expose_event, self, 0);
	return self;
}


BeatBoxSimpleOptionChooser* beat_box_simple_option_chooser_new (GdkPixbuf* enabled, GdkPixbuf* disabled) {
	return beat_box_simple_option_chooser_construct (BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, enabled, disabled);
}


void beat_box_simple_option_chooser_setOption (BeatBoxSimpleOptionChooser* self, gint index) {
	gint _tmp0_;
	g_return_if_fail (self != NULL);
	_tmp0_ = gee_collection_get_size ((GeeCollection*) self->priv->items);
	if (index >= _tmp0_) {
		return;
	}
	{
		gint i;
		i = 0;
		{
			gboolean _tmp1_;
			_tmp1_ = TRUE;
			while (TRUE) {
				gint _tmp2_;
				if (!_tmp1_) {
					i = i + 1;
				}
				_tmp1_ = FALSE;
				_tmp2_ = gee_collection_get_size ((GeeCollection*) self->priv->items);
				if (!(i < _tmp2_)) {
					break;
				}
				if (i == index) {
					gpointer _tmp3_ = NULL;
					GtkCheckMenuItem* _tmp4_;
					_tmp3_ = gee_abstract_list_get ((GeeAbstractList*) self->priv->items, i);
					_tmp4_ = (GtkCheckMenuItem*) _tmp3_;
					gtk_check_menu_item_set_active (_tmp4_, TRUE);
					_g_object_unref0 (_tmp4_);
				} else {
					gpointer _tmp5_ = NULL;
					GtkCheckMenuItem* _tmp6_;
					_tmp5_ = gee_abstract_list_get ((GeeAbstractList*) self->priv->items, i);
					_tmp6_ = (GtkCheckMenuItem*) _tmp5_;
					gtk_check_menu_item_set_active (_tmp6_, FALSE);
					_g_object_unref0 (_tmp6_);
				}
			}
		}
	}
	self->priv->clicked_index = index;
	g_signal_emit_by_name (self, "option-changed", index);
	gtk_widget_queue_draw ((GtkWidget*) self);
}


static Block12Data* block12_data_ref (Block12Data* _data12_) {
	g_atomic_int_inc (&_data12_->_ref_count_);
	return _data12_;
}


static void block12_data_unref (Block12Data* _data12_) {
	if (g_atomic_int_dec_and_test (&_data12_->_ref_count_)) {
		_g_object_unref0 (_data12_->self);
		_g_object_unref0 (_data12_->item);
		g_slice_free (Block12Data, _data12_);
	}
}


static void _lambda13_ (Block12Data* _data12_) {
	BeatBoxSimpleOptionChooser * self;
	self = _data12_->self;
	if (!self->priv->toggling) {
		gint _tmp0_;
		self->priv->toggling = TRUE;
		_tmp0_ = gee_abstract_list_index_of ((GeeAbstractList*) self->priv->items, _data12_->item);
		if (self->priv->clicked_index != _tmp0_) {
			gint _tmp1_;
			_tmp1_ = gee_abstract_list_index_of ((GeeAbstractList*) self->priv->items, _data12_->item);
			beat_box_simple_option_chooser_setOption (self, _tmp1_);
		} else {
			beat_box_simple_option_chooser_setOption (self, 0);
		}
		self->priv->toggling = FALSE;
	}
}


static void __lambda13__gtk_check_menu_item_toggled (GtkCheckMenuItem* _sender, gpointer self) {
	_lambda13_ (self);
}


gint beat_box_simple_option_chooser_appendItem (BeatBoxSimpleOptionChooser* self, const gchar* text) {
	gint result = 0;
	Block12Data* _data12_;
	GtkCheckMenuItem* _tmp0_ = NULL;
	gint _tmp1_;
	g_return_val_if_fail (self != NULL, 0);
	g_return_val_if_fail (text != NULL, 0);
	_data12_ = g_slice_new0 (Block12Data);
	_data12_->_ref_count_ = 1;
	_data12_->self = g_object_ref (self);
	_tmp0_ = (GtkCheckMenuItem*) gtk_check_menu_item_new_with_label (text);
	_data12_->item = g_object_ref_sink (_tmp0_);
	gee_abstract_collection_add ((GeeAbstractCollection*) self->priv->items, _data12_->item);
	gtk_menu_shell_append ((GtkMenuShell*) self->priv->menu, (GtkWidget*) ((GtkMenuItem*) _data12_->item));
	g_signal_connect_data (_data12_->item, "toggled", (GCallback) __lambda13__gtk_check_menu_item_toggled, block12_data_ref (_data12_), (GClosureNotify) block12_data_unref, 0);
	gtk_widget_show ((GtkWidget*) _data12_->item);
	_tmp1_ = gee_collection_get_size ((GeeCollection*) self->priv->items);
	result = _tmp1_ - 1;
	block12_data_unref (_data12_);
	_data12_ = NULL;
	return result;
}


static gboolean beat_box_simple_option_chooser_real_buttonPress (BeatBoxSimpleOptionChooser* self, GdkEventButton* event) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	if ((*event).type == GDK_BUTTON_PRESS) {
		_tmp0_ = (*event).button == 1;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		if (self->priv->clicked_index == 0) {
			beat_box_simple_option_chooser_setOption (self, self->priv->previous_index);
		} else {
			self->priv->previous_index = self->priv->clicked_index;
			beat_box_simple_option_chooser_setOption (self, 0);
		}
	} else {
		gboolean _tmp1_ = FALSE;
		if ((*event).type == GDK_BUTTON_PRESS) {
			_tmp1_ = (*event).button == 3;
		} else {
			_tmp1_ = FALSE;
		}
		if (_tmp1_) {
			guint32 _tmp2_;
			_tmp2_ = gtk_get_current_event_time ();
			gtk_menu_popup (self->priv->menu, NULL, NULL, NULL, NULL, (guint) 3, _tmp2_);
		}
	}
	result = FALSE;
	return result;
}


gboolean beat_box_simple_option_chooser_buttonPress (BeatBoxSimpleOptionChooser* self, GdkEventButton* event) {
	return BEAT_BOX_SIMPLE_OPTION_CHOOSER_GET_CLASS (self)->buttonPress (self, event);
}


static gboolean beat_box_simple_option_chooser_real_exposeEvent (BeatBoxSimpleOptionChooser* self, GdkEventExpose* event) {
	gboolean result = FALSE;
	GdkPixbuf* _tmp0_ = NULL;
	GtkStyle* _tmp1_ = NULL;
	gint _tmp2_;
	gint _tmp3_;
	gint _tmp4_;
	g_return_val_if_fail (self != NULL, FALSE);
	if (self->priv->clicked_index != 0) {
		_tmp0_ = self->priv->enabled;
	} else {
		_tmp0_ = self->priv->disabled;
	}
	_tmp1_ = gtk_widget_get_style ((GtkWidget*) self);
	g_object_get ((GtkWidget*) self, "width-request", &_tmp2_, NULL);
	g_object_get ((GtkWidget*) self, "width-request", &_tmp3_, NULL);
	g_object_get ((GtkWidget*) self, "height-request", &_tmp4_, NULL);
	gdk_draw_pixbuf ((GdkDrawable*) (*event).window, _tmp1_->bg_gc[0], _tmp0_, 0, 0, ((*event).area.width - _tmp2_) / 2, 0, _tmp3_, _tmp4_, GDK_RGB_DITHER_NONE, 0, 0);
	result = TRUE;
	return result;
}


gboolean beat_box_simple_option_chooser_exposeEvent (BeatBoxSimpleOptionChooser* self, GdkEventExpose* event) {
	return BEAT_BOX_SIMPLE_OPTION_CHOOSER_GET_CLASS (self)->exposeEvent (self, event);
}


static void beat_box_simple_option_chooser_class_init (BeatBoxSimpleOptionChooserClass * klass) {
	beat_box_simple_option_chooser_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (BeatBoxSimpleOptionChooserPrivate));
	BEAT_BOX_SIMPLE_OPTION_CHOOSER_CLASS (klass)->buttonPress = beat_box_simple_option_chooser_real_buttonPress;
	BEAT_BOX_SIMPLE_OPTION_CHOOSER_CLASS (klass)->exposeEvent = beat_box_simple_option_chooser_real_exposeEvent;
	G_OBJECT_CLASS (klass)->finalize = beat_box_simple_option_chooser_finalize;
	g_signal_new ("option_changed", BEAT_BOX_TYPE_SIMPLE_OPTION_CHOOSER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__INT, G_TYPE_NONE, 1, G_TYPE_INT);
}


static void beat_box_simple_option_chooser_instance_init (BeatBoxSimpleOptionChooser * self) {
	self->priv = BEAT_BOX_SIMPLE_OPTION_CHOOSER_GET_PRIVATE (self);
}


static void beat_box_simple_option_chooser_finalize (GObject* obj) {
	BeatBoxSimpleOptionChooser * self;
	self = BEAT_BOX_SIMPLE_OPTION_CHOOSER (obj);
	_g_object_unref0 (self->priv->menu);
	_g_object_unref0 (self->priv->items);
	_g_object_unref0 (self->priv->enabled);
	_g_object_unref0 (self->priv->disabled);
	G_OBJECT_CLASS (beat_box_simple_option_chooser_parent_class)->finalize (obj);
}


GType beat_box_simple_option_chooser_get_type (void) {
	static volatile gsize beat_box_simple_option_chooser_type_id__volatile = 0;
	if (g_once_init_enter (&beat_box_simple_option_chooser_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (BeatBoxSimpleOptionChooserClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) beat_box_simple_option_chooser_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (BeatBoxSimpleOptionChooser), 0, (GInstanceInitFunc) beat_box_simple_option_chooser_instance_init, NULL };
		GType beat_box_simple_option_chooser_type_id;
		beat_box_simple_option_chooser_type_id = g_type_register_static (GTK_TYPE_EVENT_BOX, "BeatBoxSimpleOptionChooser", &g_define_type_info, 0);
		g_once_init_leave (&beat_box_simple_option_chooser_type_id__volatile, beat_box_simple_option_chooser_type_id);
	}
	return beat_box_simple_option_chooser_type_id__volatile;
}



