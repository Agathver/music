/* RatingWidget.c generated by valac 0.11.6, the Vala compiler
 * generated from RatingWidget.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <gdk/gdk.h>
#include <gdk-pixbuf/gdk-pixdata.h>
#include <string.h>


#define BEAT_BOX_TYPE_RATING_WIDGET (beat_box_rating_widget_get_type ())
#define BEAT_BOX_RATING_WIDGET(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), BEAT_BOX_TYPE_RATING_WIDGET, BeatBoxRatingWidget))
#define BEAT_BOX_RATING_WIDGET_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), BEAT_BOX_TYPE_RATING_WIDGET, BeatBoxRatingWidgetClass))
#define BEAT_BOX_IS_RATING_WIDGET(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), BEAT_BOX_TYPE_RATING_WIDGET))
#define BEAT_BOX_IS_RATING_WIDGET_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), BEAT_BOX_TYPE_RATING_WIDGET))
#define BEAT_BOX_RATING_WIDGET_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), BEAT_BOX_TYPE_RATING_WIDGET, BeatBoxRatingWidgetClass))

typedef struct _BeatBoxRatingWidget BeatBoxRatingWidget;
typedef struct _BeatBoxRatingWidgetClass BeatBoxRatingWidgetClass;
typedef struct _BeatBoxRatingWidgetPrivate BeatBoxRatingWidgetPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))

struct _BeatBoxRatingWidget {
	GtkEventBox parent_instance;
	BeatBoxRatingWidgetPrivate * priv;
};

struct _BeatBoxRatingWidgetClass {
	GtkEventBoxClass parent_class;
	gboolean (*buttonPress) (BeatBoxRatingWidget* self, GdkEventButton* event);
	gboolean (*exposeEvent) (BeatBoxRatingWidget* self, GdkEventExpose* event);
};

struct _BeatBoxRatingWidgetPrivate {
	gint rating;
	GdkPixbuf* _canvas;
	GdkPixbuf* not_starred;
	GdkPixbuf* starred;
};


static gpointer beat_box_rating_widget_parent_class = NULL;

GType beat_box_rating_widget_get_type (void) G_GNUC_CONST;
#define BEAT_BOX_RATING_WIDGET_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), BEAT_BOX_TYPE_RATING_WIDGET, BeatBoxRatingWidgetPrivate))
enum  {
	BEAT_BOX_RATING_WIDGET_DUMMY_PROPERTY
};
BeatBoxRatingWidget* beat_box_rating_widget_new (void);
BeatBoxRatingWidget* beat_box_rating_widget_construct (GType object_type);
void beat_box_rating_widget_set_rating (BeatBoxRatingWidget* self, gint new_rating);
void beat_box_rating_widget_updateRating (BeatBoxRatingWidget* self, gint fake_rating);
gboolean beat_box_rating_widget_buttonPress (BeatBoxRatingWidget* self, GdkEventButton* event);
static gboolean _beat_box_rating_widget_buttonPress_gtk_widget_button_press_event (GtkWidget* _sender, GdkEventButton* event, gpointer self);
gboolean beat_box_rating_widget_exposeEvent (BeatBoxRatingWidget* self, GdkEventExpose* event);
static gboolean _beat_box_rating_widget_exposeEvent_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self);
gint beat_box_rating_widget_get_rating (BeatBoxRatingWidget* self);
static gboolean beat_box_rating_widget_real_motion_notify_event (GtkWidget* base, GdkEventMotion* event);
static gboolean beat_box_rating_widget_real_buttonPress (BeatBoxRatingWidget* self, GdkEventButton* event);
static gboolean beat_box_rating_widget_real_exposeEvent (BeatBoxRatingWidget* self, GdkEventExpose* event);
static void beat_box_rating_widget_finalize (GObject* obj);


static gboolean _beat_box_rating_widget_buttonPress_gtk_widget_button_press_event (GtkWidget* _sender, GdkEventButton* event, gpointer self) {
	gboolean result;
	result = beat_box_rating_widget_buttonPress (self, event);
	return result;
}


static gboolean _beat_box_rating_widget_exposeEvent_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self) {
	gboolean result;
	result = beat_box_rating_widget_exposeEvent (self, event);
	return result;
}


BeatBoxRatingWidget* beat_box_rating_widget_construct (GType object_type) {
	BeatBoxRatingWidget * self = NULL;
	GdkColor c = {0};
	GdkColor _tmp0_ = {0};
	GdkPixbuf* _tmp1_ = NULL;
	GdkPixbuf* _tmp2_;
	GdkPixbuf* _tmp3_ = NULL;
	GdkPixbuf* _tmp4_;
	gint _tmp5_;
	gint _tmp6_;
	gint _tmp7_;
	gint _tmp8_;
	GdkPixbuf* _tmp9_ = NULL;
	GdkPixbuf* _tmp10_;
	self = (BeatBoxRatingWidget*) g_object_new (object_type, NULL);
	memset (&c, 0, sizeof (GdkColor));
	gdk_color_parse ("#FFFFFF", &_tmp0_);
	c = _tmp0_;
	gtk_widget_modify_bg ((GtkWidget*) self, GTK_STATE_NORMAL, &c);
	_tmp1_ = gtk_widget_render_icon ((GtkWidget*) self, "starred", GTK_ICON_SIZE_SMALL_TOOLBAR, NULL);
	_tmp2_ = _tmp1_;
	_g_object_unref0 (self->priv->starred);
	self->priv->starred = _tmp2_;
	_tmp3_ = gtk_widget_render_icon ((GtkWidget*) self, "not-starred", GTK_ICON_SIZE_SMALL_TOOLBAR, NULL);
	_tmp4_ = _tmp3_;
	_g_object_unref0 (self->priv->not_starred);
	self->priv->not_starred = _tmp4_;
	_tmp5_ = gdk_pixbuf_get_width (self->priv->starred);
	g_object_set ((GtkWidget*) self, "width-request", _tmp5_ * 5, NULL);
	_tmp6_ = gdk_pixbuf_get_height (self->priv->starred);
	g_object_set ((GtkWidget*) self, "height-request", _tmp6_, NULL);
	_tmp9_ = gdk_pixbuf_new (GDK_COLORSPACE_RGB, TRUE, 8, (g_object_get ((GtkWidget*) self, "width-request", &_tmp7_, NULL), _tmp7_), (g_object_get ((GtkWidget*) self, "height-request", &_tmp8_, NULL), _tmp8_));
	_tmp10_ = _tmp9_;
	_g_object_unref0 (self->priv->_canvas);
	self->priv->_canvas = _tmp10_;
	beat_box_rating_widget_set_rating (self, 0);
	beat_box_rating_widget_updateRating (self, 0);
	g_signal_connect_object ((GtkWidget*) self, "button-press-event", (GCallback) _beat_box_rating_widget_buttonPress_gtk_widget_button_press_event, self, 0);
	g_signal_connect_object ((GtkWidget*) self, "expose-event", (GCallback) _beat_box_rating_widget_exposeEvent_gtk_widget_expose_event, self, 0);
	return self;
}


BeatBoxRatingWidget* beat_box_rating_widget_new (void) {
	return beat_box_rating_widget_construct (BEAT_BOX_TYPE_RATING_WIDGET);
}


void beat_box_rating_widget_set_rating (BeatBoxRatingWidget* self, gint new_rating) {
	g_return_if_fail (self != NULL);
	if (self->priv->rating == new_rating) {
		return;
	}
	self->priv->rating = new_rating;
	beat_box_rating_widget_updateRating (self, self->priv->rating);
	g_signal_emit_by_name (self, "rating-changed", self->priv->rating);
}


gint beat_box_rating_widget_get_rating (BeatBoxRatingWidget* self) {
	gint result = 0;
	g_return_val_if_fail (self != NULL, 0);
	result = self->priv->rating;
	return result;
}


static gboolean beat_box_rating_widget_real_motion_notify_event (GtkWidget* base, GdkEventMotion* event) {
	BeatBoxRatingWidget * self;
	gboolean result = FALSE;
	gint new_rating;
	gint _tmp0_;
	gint buffer;
	self = (BeatBoxRatingWidget*) base;
	new_rating = 0;
	buffer = (((GtkWidget*) self)->allocation.width - (g_object_get ((GtkWidget*) self, "width-request", &_tmp0_, NULL), _tmp0_)) / 2;
	if (((*event).x - buffer) > 5) {
		new_rating = (gint) ((((*event).x - buffer) + 18) / 18);
	} else {
		new_rating = 0;
	}
	beat_box_rating_widget_updateRating (self, new_rating);
	result = TRUE;
	return result;
}


static gboolean beat_box_rating_widget_real_buttonPress (BeatBoxRatingWidget* self, GdkEventButton* event) {
	gboolean result = FALSE;
	gint new_rating;
	gint _tmp0_;
	gint buffer;
	g_return_val_if_fail (self != NULL, FALSE);
	new_rating = 0;
	buffer = (((GtkWidget*) self)->allocation.width - (g_object_get ((GtkWidget*) self, "width-request", &_tmp0_, NULL), _tmp0_)) / 2;
	if (((*event).x - buffer) > 5) {
		new_rating = (gint) ((((*event).x - buffer) + 18) / 18);
	} else {
		new_rating = 0;
	}
	beat_box_rating_widget_updateRating (self, new_rating);
	beat_box_rating_widget_set_rating (self, new_rating);
	result = TRUE;
	return result;
}


gboolean beat_box_rating_widget_buttonPress (BeatBoxRatingWidget* self, GdkEventButton* event) {
	return BEAT_BOX_RATING_WIDGET_GET_CLASS (self)->buttonPress (self, event);
}


void beat_box_rating_widget_updateRating (BeatBoxRatingWidget* self, gint fake_rating) {
	g_return_if_fail (self != NULL);
	gdk_pixbuf_fill (self->priv->_canvas, (guint32) ((guint) 0xffffff00LL));
	{
		gint i;
		i = 0;
		{
			gboolean _tmp0_;
			_tmp0_ = TRUE;
			while (TRUE) {
				if (!_tmp0_) {
					i++;
				}
				_tmp0_ = FALSE;
				if (!(i < 5)) {
					break;
				}
				if (i < fake_rating) {
					gint _tmp1_;
					gint _tmp2_;
					gint _tmp3_;
					_tmp1_ = gdk_pixbuf_get_width (self->priv->starred);
					_tmp2_ = gdk_pixbuf_get_height (self->priv->starred);
					_tmp3_ = gdk_pixbuf_get_width (self->priv->starred);
					gdk_pixbuf_copy_area (self->priv->starred, 0, 0, _tmp1_, _tmp2_, self->priv->_canvas, i * _tmp3_, 0);
				} else {
					gint _tmp4_;
					gint _tmp5_;
					gint _tmp6_;
					_tmp4_ = gdk_pixbuf_get_width (self->priv->not_starred);
					_tmp5_ = gdk_pixbuf_get_height (self->priv->not_starred);
					_tmp6_ = gdk_pixbuf_get_width (self->priv->not_starred);
					gdk_pixbuf_copy_area (self->priv->not_starred, 0, 0, _tmp4_, _tmp5_, self->priv->_canvas, i * _tmp6_, 0);
				}
			}
		}
	}
	gtk_widget_queue_draw ((GtkWidget*) self);
}


/** @override on_expose_event to paint our own custom widget **/
static gboolean beat_box_rating_widget_real_exposeEvent (BeatBoxRatingWidget* self, GdkEventExpose* event) {
	gboolean result = FALSE;
	GtkStyle* _tmp0_ = NULL;
	gint _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = gtk_widget_get_style ((GtkWidget*) self);
	gdk_draw_pixbuf ((GdkDrawable*) (*event).window, _tmp0_->bg_gc[0], self->priv->_canvas, 0, 0, ((*event).area.width - (g_object_get ((GtkWidget*) self, "width-request", &_tmp1_, NULL), _tmp1_)) / 2, 0, (g_object_get ((GtkWidget*) self, "width-request", &_tmp2_, NULL), _tmp2_), (g_object_get ((GtkWidget*) self, "height-request", &_tmp3_, NULL), _tmp3_), GDK_RGB_DITHER_NONE, 0, 0);
	result = TRUE;
	return result;
}


gboolean beat_box_rating_widget_exposeEvent (BeatBoxRatingWidget* self, GdkEventExpose* event) {
	return BEAT_BOX_RATING_WIDGET_GET_CLASS (self)->exposeEvent (self, event);
}


static void beat_box_rating_widget_class_init (BeatBoxRatingWidgetClass * klass) {
	beat_box_rating_widget_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (BeatBoxRatingWidgetPrivate));
	GTK_WIDGET_CLASS (klass)->motion_notify_event = beat_box_rating_widget_real_motion_notify_event;
	BEAT_BOX_RATING_WIDGET_CLASS (klass)->buttonPress = beat_box_rating_widget_real_buttonPress;
	BEAT_BOX_RATING_WIDGET_CLASS (klass)->exposeEvent = beat_box_rating_widget_real_exposeEvent;
	G_OBJECT_CLASS (klass)->finalize = beat_box_rating_widget_finalize;
	g_signal_new ("rating_changed", BEAT_BOX_TYPE_RATING_WIDGET, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__INT, G_TYPE_NONE, 1, G_TYPE_INT);
}


static void beat_box_rating_widget_instance_init (BeatBoxRatingWidget * self) {
	self->priv = BEAT_BOX_RATING_WIDGET_GET_PRIVATE (self);
}


static void beat_box_rating_widget_finalize (GObject* obj) {
	BeatBoxRatingWidget * self;
	self = BEAT_BOX_RATING_WIDGET (obj);
	_g_object_unref0 (self->priv->_canvas);
	_g_object_unref0 (self->priv->not_starred);
	_g_object_unref0 (self->priv->starred);
	G_OBJECT_CLASS (beat_box_rating_widget_parent_class)->finalize (obj);
}


GType beat_box_rating_widget_get_type (void) {
	static volatile gsize beat_box_rating_widget_type_id__volatile = 0;
	if (g_once_init_enter (&beat_box_rating_widget_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (BeatBoxRatingWidgetClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) beat_box_rating_widget_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (BeatBoxRatingWidget), 0, (GInstanceInitFunc) beat_box_rating_widget_instance_init, NULL };
		GType beat_box_rating_widget_type_id;
		beat_box_rating_widget_type_id = g_type_register_static (GTK_TYPE_EVENT_BOX, "BeatBoxRatingWidget", &g_define_type_info, 0);
		g_once_init_leave (&beat_box_rating_widget_type_id__volatile, beat_box_rating_widget_type_id);
	}
	return beat_box_rating_widget_type_id__volatile;
}



